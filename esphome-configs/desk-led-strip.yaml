# Merkury EW010 RGBW LED Strip - Desk Task Lighting
# BK7231N (CB3S) - Flashed via Tuya Cloudcutter
#
# GPIO Mapping:
#   P7:  White PWM output
#   P8:  Red PWM output
#   P24: Green PWM output
#   P26: Blue PWM output
#   P9:  Built-in button (active low)

esphome:
  name: desk-led-strip
  friendly_name: Desk LED Strip

bk72xx:
  board: cb3s

logger:

api:
  encryption:
    key: !secret api_encryption_key

ota:
  - platform: esphome
    password: !secret ota_password

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

  ap:
    ssid: "Desk-LED-Strip"
    password: !secret ap_password

captive_portal:

# RGBW Light using PWM outputs
output:
  - platform: libretiny_pwm
    id: output_red
    pin: P8

  - platform: libretiny_pwm
    id: output_green
    pin: P24

  - platform: libretiny_pwm
    id: output_blue
    pin: P26

  - platform: libretiny_pwm
    id: output_white
    pin: P7

light:
  - platform: rgbw
    id: led_strip
    name: "LED Strip"
    red: output_red
    green: output_green
    blue: output_blue
    white: output_white
    color_interlock: true
    effects:
      - random:
          name: "Slow Random"
          transition_length: 5s
          update_interval: 7s
      - random:
          name: "Fast Random"
          transition_length: 1s
          update_interval: 2s
      - pulse:
          name: "Pulse"
          transition_length: 2s
          update_interval: 2s

# Physical button on the strip
binary_sensor:
  - platform: gpio
    id: button
    name: "Button"
    pin:
      number: P9
      inverted: true
      mode:
        input: true
        pullup: true
    filters:
      - delayed_off: 10ms
    on_click:
      - min_length: 50ms
        max_length: 500ms
        then:
          - light.toggle: led_strip
      - min_length: 500ms
        max_length: 2000ms
        then:
          # Long press: start color cycling effect
          - light.turn_on:
              id: led_strip
              brightness: 100%
              effect: "Slow Random"
